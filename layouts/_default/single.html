{{ define "main" }}
{{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
{{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}

<div class="post">

  <h1 class="post-title">{{ .Title | markdownify }}</h1>
  <div class="post-meta">
    {{ if .Date | default nil }}
    <span class="post-date">
      {{ .Date.Format ($.Site.Params.DateFormatSingle | default "2006-01-02") }}
    </span>
    {{ end }}
  </div>

  {{/*  评论与阅读统计  */}}
  <div class="post-meta">
    {{- if .Site.Params.valine.enable -}}
    <span><span class="valine-comment-count" data-xid="{{ .RelPermalink }}">0</span> Comments / <span
        id="{{ .RelPermalink }}" class="leancloud_visitors" data-flag-title="{{ .Title }}"><span
          class="leancloud-visitors-count">0</span> Views / </span></span>
    {{ end }}

    <!-- 计算修改时间 -->
    <span class="post-date">
      {{ $ageDays := div (sub now.Unix .Lastmod.Unix) 86400 }}
      {{ $ageMonths := div (sub now.Unix .Lastmod.Unix) 2592000 }}
      {{ if eq $ageDays 0 }}
      Updated today
      {{ else if lt $ageDays 31 }}
      Updated {{ $ageDays }} {{ cond (eq $ageDays 1) "day" "days"}} ago
      {{ else }}
      Updated {{ $ageMonths }} {{ cond (eq $ageMonths 1) "month" "months" }} ago
      {{ end }}
    </span>

  </div>

  {{ if .Params.tags }}
  <span class="post-tags">
    {{ range .Params.tags }}
    <a href="{{ (urlize (printf "tags/%s" . )) | absURL }}/">#{{ . }}</a>&nbsp;
    {{ end }}
  </span>
  {{ end }}

  {{ if .Params.Cover }}
  <figure class="post-cover">
    {{ if .Params.UseRelativeCover }}
    <img src="{{ (printf "%s%s" .Permalink .Params.Cover ) }}"
      alt="{{ .Params.CoverAlt | plainify | default .Title }}" />
    {{ else }}
    <img src="{{ .Params.Cover | absURL }}" alt="{{ .Params.CoverAlt | plainify | default .Title }}" />
    {{ end }}

    {{ if .Params.CoverCaption }}
    <figcaption class="center">{{ .Params.CoverCaption | markdownify }}</figcaption>
    {{ end }}
  </figure>
  {{ end }}

  <div class="post-content">

    {{/*  目录  */}}
    {{ if and .Params.Toc $.Site.Params.Toc | default true }}
    {{ partial "toc.html" . }}
    {{ end }}
    {{/*  目录  */}}

    {{ .Content }}
  </div>

  {{ if eq .Type "posts" }}
  {{ if or .NextInSection .PrevInSection }}
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">{{ $.Site.Params.ReadOtherPosts | default "More" }}</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      {{ if .NextInSection }}
      <span class="button previous">
        <a href="{{ .NextInSection.Permalink }}">
          <span class="button__icon">←</span>
          <span class="button__text">{{ .NextInSection.Title }}</span>
        </a>
      </span>
      {{ end }}
      {{ if .PrevInSection }}
      <span class="button next">
        <a href="{{ .PrevInSection.Permalink }}">
          <span class="button__text">{{ .PrevInSection.Title }}</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      {{ end }}
    </div>
  </div>
  {{ end }}
  {{ end }}

  {{ if not (eq .Params.Comments "false") }}
  {{ partial "comments.html" . }}
  {{ end }}

</div>
{{ end }}